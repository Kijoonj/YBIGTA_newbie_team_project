import os
import json
from langchain_upstage import UpstageEmbeddings
from langchain_community.vectorstores import FAISS
from dotenv import load_dotenv

load_dotenv()

# --- 1. 데이터 준비 (총 45개) ---
raw_data = [
    # === 갤럭시 S24 (15개) ===
    "갤럭시 S24 울트라 줌 기능은 진짜 콘서트 필수템임. 100배 줌 땡기면 가수 땀구멍까지 보일 기세.",
    "S24 플러스 디자인 이번에 진짜 잘 뽑음. 깻잎 통조림 디자인인데 그립감도 나쁘지 않음.",
    "S24 AI 실시간 통역 기능 써봤는데 해외여행 가서 식당 예약할 때 진짜 유용했어. 영어 공포증 해결됨.",
    "갤럭시 S24 일반 모델 발열 걱정했는데, 고사양 게임 돌려도 생각보다 미지근해서 놀랐음. 방열 설계 잘한 듯.",
    "이번 갤S24 화면 밝기 미쳤음. 햇빛 쨍쨍한 날 밖에서 봐도 선명하게 잘 보여서 좋더라.",
    "S24 배터리 타임은 전작이랑 비슷한데, 울트라는 확실히 오래 감. 하루 종일 써도 30% 남음.",
    "갤럭시 AI 요약 기능으로 긴 기사 3줄 요약해 주는 거 업무 볼 때 개꿀임.",
    "S24 엑시노스 들어갔다고 해서 걱정했는데, 막상 써보니 버벅임 없고 빠릿빠릿함.",
    "서클 투 서치 기능 진짜 편함. 인스타 보다가 옷 궁금하면 동그라미만 치면 바로 찾아줌.",
    "S24 울트라 티타늄 그레이 색상 실물 깡패임. 고급지게 잘 나왔음.",
    "카메라 셔터 렉 많이 줄어들어서 좋다. 아이들 찍어줄 때 흔들림 없이 잘 찍힘.",
    "S24 스피커 음질이 좀 더 좋아진 느낌? 베이스가 빵빵해서 영상 볼 맛 남.",
    "굿락으로 커스터마이징 하는 맛에 갤럭시 씀. S24도 역시 굿락 필수.",
    "야간 모드 촬영할 때 빛 번짐이 좀 줄어든 것 같음. 고스트 현상도 덜하고.",
    "삼성 페이 되는 건 역시 대체 불가 장점. 지갑 안 들고 다녀도 돼서 너무 편함.",

    # === 아이폰 15 (15개) ===
    "아이폰 15 프로 티타늄 소재라 그런지 들자마자 가볍다는 느낌 확 듦. 전작 쓰다 바꾸니까 손목이 편하다.",
    "아이폰 15 일반 모델 핑크 색상 실물 깡패임.. 딸기우유 색감 진짜 예쁘게 잘 뽑았음.",
    "드디어 아이폰 15에 C타입 들어와서 충전기 하나로 아이패드랑 같이 쓸 수 있는 게 제일 편함.",
    "아이폰 15 프로 맥스 발열 이슈 있다고 해서 걱정했는데, 업데이트 이후로는 발열 거의 못 느낌.",
    "아이폰 카메라 인물 모드는 역시 넘사벽임. 찍으면 바로 화보 느낌 나서 보정이 필요 없음.",
    "아이폰 15 배터리는 좀 아쉽다. 프로 모델 쓰는데 헤비하게 쓰면 보조배터리 필수인 듯.",
    "다이내믹 아일랜드 처음엔 거슬렸는데 쓰다 보니 알림 뜨는 거 편하고 귀여움.",
    "액션 버튼에 단축어 설정해 두니까 진짜 편함. 무음 모드 전환 말고 카메라 바로 켜기로 쓰는 중.",
    "아이폰 15 일반 모델도 120Hz 주사율 좀 넣어주지.. 60Hz는 스크롤할 때 역체감 심함.",
    "C타입 바뀌고 나서 데이터 전송 속도 빨라진 거 체감됨. 영상 옮길 때 속 시원함.",
    "아이폰 15 후면 유리가 무광이라 지문 안 묻어서 좋음. 촉감도 부들부들하고.",
    "맥스 모델은 확실히 크고 무겁긴 함. 한 손 조작은 거의 불가능.",
    "iOS 17 올리고 나서 가끔 키보드 렉 걸리는 거 좀 짜증 남. 빨리 패치 좀.",
    "아이폰 통화 녹음 안 되는 건 여전히 아쉽지만, 에이닷 쓰면 되니까 그나마 다행.",
    "맥세이프 충전기 자력 짱짱해서 좋음. 카드 지갑 붙이고 다니기 딱임.",

    # === 구글 픽셀 8 (15개) ===
    "픽셀 8 카메라 색감은 진짜 미쳤음. 인위적이지 않고 눈으로 보는 그대로 담기는데 감성 터짐.",
    "픽셀 8 프로 매직 이레이저 기능 써봤는데, 사진에 찍힌 행인 지우는 거 포토샵보다 편함.",
    "픽셀 폰 다 좋은데 한국 정발 안 돼서 직구해야 하고 AS 받기 힘든 게 제일 큰 단점 ㅠㅠ",
    "순정 안드로이드 빠릿빠릿한 맛에 픽셀 씀. 삼성 원UI보다 훨씬 가볍고 부드러운 느낌.",
    "픽셀 8 한국에서 삼성페이 안 되는 건 치명적임. 지갑 들고 다니기 귀찮아서 다시 갤럭시 갈까 고민 중.",
    "픽셀 통화 녹음 기능이 한국 폰처럼 자동 녹음이 안 돼서 업무용으로는 좀 불편함.",
    "픽셀 디자인은 호불호 갈리는데 나는 저 카메라 바(Bar) 디자인이 독특해서 맘에 듦.",
    "구글 포토 무제한 저장 혜택 없어진 건 아쉽지만, AI 편집 기능들이 강력해서 만족함.",
    "픽셀 8 화면 주사율 120Hz 부드러움. 스크롤할 때 끊김 없이 매끄러움.",
    "베스트 테이크 기능 대박임. 단체 사진 찍고 표정 이상한 사람 얼굴만 다른 사진에서 가져와서 합성 가능.",
    "텐서 칩 성능이 스냅드래곤보다 떨어지는 건 팩트. 고사양 게임 돌리면 발열 좀 있음.",
    "픽셀 UI 디자인이 동글동글하고 귀여움. 안드로이드 커스텀 테마 적용하기도 좋고.",
    "배터리 타임은 그냥 평범함. 하루 쓰기엔 무리 없지만 엄청 오래가진 않음.",
    "직구폰이라 VoLTE 설정하는 게 좀 귀찮았음. 통신사 고객센터 전화해서 OMD 등록해야 함.",
    "구글 어시스턴트 호출 반응 속도가 확실히 빠름. 음성 인식 정확도도 높고."
]

def create_vector_db():
    print("🚀 데이터 임베딩 시작...")
    
    current_dir = os.path.dirname(os.path.abspath(__file__))
    print(f"📍 현재 위치: {current_dir}")
    
    save_path = os.path.join(current_dir, "..", "db", "faiss_index")
    save_path = os.path.abspath(save_path)  # 절대 경로로 변환
    
    print(f"💾 저장 경로: {save_path}")
    
    os.makedirs(save_path, exist_ok=True)
    print(f"✅ 폴더 생성 완료")
    
    embedding_model = UpstageEmbeddings(model="solar-embedding-1-large")
    
    vectorstore = FAISS.from_texts(raw_data, embedding_model)
    
    vectorstore.save_local(save_path)
    
    print(f"✅ 임베딩 완료! '{save_path}'에 저장되었습니다.")
    
    meta_info = {
        "total_documents": len(raw_data),
        "embedding_model": "solar-embedding-1-large",
        "created_at": "2026-02-08",
        "description": "스마트폰 리뷰 데이터 (갤럭시 S24, 아이폰 15, 픽셀 8)"
    }
    
    meta_path = os.path.join(save_path, "meta.json")
    with open(meta_path, 'w', encoding='utf-8') as f:
        json.dump(meta_info, f, ensure_ascii=False, indent=2)
    
    print(f"📄 meta.json 생성 완료")
    
    if os.path.exists(save_path):
        files = os.listdir(save_path)
        print(f"📂 저장된 파일 목록: {files}")
    else:
        print("❌ 경로가 존재하지 않습니다!")

if __name__ == "__main__":
    create_vector_db()